

<?php $__env->startSection('title'); ?>
    <p>Atribuire departamente</p>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('content'); ?>
	
    <style>
	.mev_hide_el {
		display:none;	
	}
	
	.mev_spacer {
		height:30px;
	}
	
	.mev_background_grey {
		background:#eee;
		color:#333;
	}
	
	.mev_active {
		background:#428bca;
		color:#fff;
	}
	
	.mev_cursor_fix {
		cursor:pointer;
	}
	</style>
	<form action="<?php echo URL::to('salveaza_departamente_utilizator'); ?>" method="post" id="template_form" autocomplete="off">
    <?php if($input_form['edit']): ?> <input type="hidden" name="edit" value="<?php echo $input_form['edit']; ?>" /> <?php endif; ?>
    <?php if(Session::has('message')): ?>
        <p class="alert <?php if($errors->isEmpty()): ?> alert-success <?php else: ?> alert-danger <?php endif; ?>"><?php echo Session::get('message'); ?></p>
    <?php endif; ?>    
    
           
        <div class="row">            
            <div class="col-lg-6">
                <!-- nume -->
                <div class="form-group">
                    <label>Nume utilizator</label>
                    <input class="form-control" name="full_name" disabled="disabled" value="<?php echo $utilizator -> full_name; ?>" />
                </div>
                <!-- sfarsit nume -->
            </div>            
            <div class="col-lg-6">
                <!-- tip -->
                <div class="form-group <?php if($errors->has('organizatie')): ?> has-error <?php endif; ?>" id="organizatie">
                    <label>Alege organizatia</label>
                    <select name="organizatie" class="form-control" onchange="arata_entitate(this);" 
                        <?php if(count($organizatii) == 1): ?> 
                        onClick="arata_entitate(document.getElementsByName('organizatie')[0]);"
                        <?php endif; ?>>
                    	<?php if(count($organizatii) != 1): ?>
                        <option value="">Click pentru a alege</option>
                        <?php endif; ?>
                        <?php foreach($organizatii as $id => $denumire): ?> 
                            <option value="<?php echo $id; ?>" <?php if(@$input_form['organizatie'] == $id): ?> selected="selected" <?php endif; ?>><?php echo $denumire; ?></option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div> <!-- end col -->
        </div>
         
    
    
        <div class="row">   
            <div class="col-lg-6">
            	<?php foreach($organizatii as $oid => $odenumire): ?>
                <table class="table table-striped table-bordered table-hover tabel_entitati <?php if( $input_form['organizatie'] != $oid): ?> mev_hide_el <?php endif; ?>" id="organizatie_<?php echo $oid; ?>" style="border-bottom:2px solid #3071A9; ">
                    <thead class="btn-warning">                                                       
                        <tr>                                   
                            <th class="text-center" style="width:1%;"><input type="checkbox" onchange="control_all_checkboxes_in('#organizatie_' + <?php echo $oid; ?>, this);" /></th>
                            <th class="text-left">Companii <?php echo $odenumire; ?></th>
                        </tr>
                    </thead>
                    <tbody id="entitati">
                    	<?php if(isset($entitati[$oid])): ?>
            				<?php foreach($entitati[$oid] as $cid => $cdenumire): ?>
                            <tr id="companie_<?php echo $cid; ?>">
                                <td class="text-center">
                                    <input type="checkbox" class="checkbox_row_act" name="entitati[]" value="<?php echo $cid; ?>" onclick="show_hide_departments(this);" <?php if(hr($cid, @$input_form['entitati']) === true): ?> checked="checked" <?php endif; ?> />
                                </td>
                                <td class="mev_cursor_fix" onclick="trigger_click('#companie_' + <?php echo $cid; ?>)"><?php echo $cdenumire; ?></td>                                   
                            </tr>
               				<?php endforeach; ?>
                         <?php endif; ?>
                    </tbody>
                </table>
                <?php endforeach; ?>
            </div> <!-- end col -->
            
            <?php foreach($departamente as $cid => $departament): ?>
                <!-- arata departamente -->
                <div class="col-lg-6">  
                    <table class="table table-striped table-bordered table-hover tabel_departamente companie_<?php echo $cid; ?> <?php if(hr($cid, @$input_form['entitati']) !== true): ?>  mev_hide_el <?php endif; ?>" style="border-bottom:2px solid #3071A9; ">
                        <thead class="mev_active">                                                       
                            <tr>                                   
                                <th class="text-center" style="width:1%;"><input type="checkbox" onchange="control_all_checkboxes_in('.companie_' + <?php echo $cid; ?>, this);" /></th>
                                <th class="text-left">Departamente <?php echo $entitati_simplu[$cid]; ?></th>
                            </tr>
                        </thead>
                        <tbody id="departamente_<?php echo $cid; ?>">
                            <?php foreach($departament as $did => $ddenumire): ?>
                                <tr id="departament_<?php echo $did; ?>">
                                    <td class="text-center">
                                        <input type="checkbox" class="checkbox_row_act" name="departamente[<?php echo $cid; ?>][]" value="<?php echo $did; ?>"  <?php if(hr($did, @$input_form['departamente'][$cid] ) === true): ?> checked="checked" <?php endif; ?> />
                                    </td>
                                    <td class="mev_cursor_fix" onclick="trigger_click('#departament_' + <?php echo $did; ?>)"><?php echo $ddenumire; ?></td>                                   
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table> 
                    <div class="row mev_spacer"></div> <!-- make some space --> 
                </div> <!-- end col -->
                <!-- sfarsit afisare departamente -->
            <?php endforeach; ?>            
            
            
        </div>
        <div class="row mev_spacer"></div>
    
	<div class="row mev_spacer"></div>    

    <div class="row col-lg-12 text-center">
        <input type="submit" name="btn_submit" class="btn btn-primary btn-lg button-width" value="Salveaza" />
        <a href="<?php echo URL::to('admin/users/list'); ?>">
            <input type="button" id="back" class="btn btn-warning btn-lg button-width" value="Inapoi" />
        </a>                                                
    </div>
    <?php echo Form::token(); ?> 
</form>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('footer_scripts'); ?>
    <?php echo HTML::script('assets/js/plugins/dataTables/jquery.dataTables.js'); ?>

    <?php echo HTML::script('assets/js/plugins/dataTables/dataTables.bootstrap.js'); ?>

    <?php echo HTML::script('assets/js/plugins/dataTables/jquery.dataTables.columnFilter.js'); ?>

    <?php echo HTML::script('assets/js/plugins/bootbox.js'); ?>


    <script>
        $(document).ready(function(){
        });
		
		/* UI core */
		function trigger_click(selector) {
			$(selector).find(':checkbox').trigger('click');	
		}
		
		function arata_entitate(el) {
			var id = el.options[el.selectedIndex].value;
			uncheck_all();
			$('.tabel_entitati').removeClass('mev_hide_el').addClass('mev_hide_el');
			$('#organizatie_' + id).removeClass('mev_hide_el');
		}
		
		function show_hide_departments(el) {
			var id = el.value;
			if(el.checked == false) {
				$('.companie_' + id).find(':checkbox').prop('checked', false);
				$('.companie_' + id).removeClass('mev_hide_el').addClass('mev_hide_el');
			}
			else {
				$('.companie_' + id).removeClass('mev_hide_el');
			}
		}
		
		function uncheck_all() {
			$('.tabel_entitati').find(':checkbox').prop('checked', false);
			$('.tabel_departamente').find(':checkbox').prop('checked', false);
			$('.tabel_departamente').removeClass('mev_hide_el').addClass('mev_hide_el');
		}
		
		function show (selector) {
			$(selector).removeClass('mev_hide_el');
		}
		
		
		function control_checkboxes_in(container, id, checked) { // utilizata la (de)selectarea checkbox-urilor dintr-un tabel
			$('.' + container + '_' + id).each(function(){
				if(checked == true)
				$(this).removeClass('mev_hide_el');
				else {
					if($(this).find(':checkbox').prop('checked') == true) {
						$(this).find(':checkbox').trigger('click');
						$(this).find(':checkbox').prop('checked', false);
					}
					$(this).addClass('mev_hide_el');
				}
			});
		} //end f
		
		
		function control_all_checkboxes_in(container, el) {
			var status = el.checked;
			
			if(status == true)
			status = false;
			else
			status = true;
			
			$(container + ' tbody').find(':checkbox').each(function(){
					$(this).prop('checked', status);
					$(this).trigger('click');
			});
		} //end f
		/* Sfarsit UI Core */
    </script>
    <?php
	
	function test_and_fill_value($input_form, $input) {
		if(isset($input_form[$input]))
		return $input_form[$input];
		
		else return '';
	}
	
	function hr($needle, $haystack) { //hide row
		if(!is_array($haystack))
		$haystack = array();
		
		if(!in_array($needle, $haystack))
		return 'mev_hide_el';
		
		return true;
	}
	
	function checked($needle, $haystack) {
		if(hr($needle, $haystack) === true)
		return 'checked="checked"';	
	}
	
	?>
    
<?php $__env->stopSection(); ?>
<?php echo $__env->make('layouts.master', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>